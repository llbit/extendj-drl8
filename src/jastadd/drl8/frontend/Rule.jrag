aspect Rule {
  syn boolean RuleDecl.isStatic() = false;

  eq RuleDecl.getChild().reachable() = true;

  eq PatternDecl.getTypeAccess().nameType() = NameType.TYPE_NAME;

  eq ThenDecl.getBlock().lookupVariable(String name) {
    RuleDecl rule = (RuleDecl) getParent().getParent();
    if (rule.hasWhenDecl()) {
      for (PatternDecl pattern : rule.getWhenDecl().getPatternDeclList()) {
        if (name.equals(pattern.getBind())) {
          ParameterDeclaration param = new ParameterDeclaration(pattern.getTypeAccess(), name);
          param.setParent(this);
          return param;
        }
      }
    }
    return emptySet();
  }
}

